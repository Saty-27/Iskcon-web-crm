cat > server/services/invoiceService.ts << 'EOF'
import PDFDocument from 'pdfkit';
import { promises as fs } from 'fs';
import path from 'path';
import { nanoid } from 'nanoid';
interface DonationReceipt {
  txnid: string;
  amount: number;
  name: string;
  email: string;
  phone: string;
  date: Date;
  paymentMethod: string;
  purpose: string;
  invoiceNumber: string;
}
export async function generateDonationPDF(donation: DonationReceipt): Promise<Buffer> {
  const doc = new PDFDocument({ margin: 50 });
  const buffers: Buffer[] = [];
  doc.on('data', buffers.push.bind(buffers));
  
  doc.fontSize(20).font('Helvetica-Bold').text('DONATION RECEIPT', { align: 'center' });
  doc.moveDown();
  doc.fontSize(16).font('Helvetica-Bold').text('ISKCON JUHU', { align: 'center' });
  doc.fontSize(12).font('Helvetica').text('Hare Krishna Land, Juhu, Mumbai - 400049', { align: 'center' });
  doc.moveDown(2);
  
  doc.font('Helvetica-Bold').text(`Receipt Number: ${donation.invoiceNumber}`, { align: 'right' });
  doc.font('Helvetica').text(`Date: ${donation.date.toLocaleDateString()}`, { align: 'right' });
  doc.moveDown(2);
  
  doc.font('Helvetica-Bold').text('Donation Details', { underline: true });
  doc.moveDown(0.5);
  
  doc.font('Helvetica')
     .text(`Donor Name: ${donation.name}`)
     .text(`Email: ${donation.email}`)
     .text(`Phone: ${donation.phone}`)
     .text(`Purpose: ${donation.purpose}`)
     .text(`Amount: â‚¹${donation.amount.toFixed(2)}`)
     .text(`Payment Method: ${donation.paymentMethod}`)
     .text(`Transaction ID: ${donation.txnid}`);
  
  doc.moveDown(2);
  doc.font('Helvetica-Bold').fillColor('#553c9a').text('Thank You!', { align: 'center' });
  doc.font('Helvetica').fillColor('black').text('Your support helps us serve Krishna.', { align: 'center' });
  doc.moveDown();
  doc.fontSize(8).text('This is an electronically generated receipt.', { align: 'center' });
  
  doc.end();
  
  return new Promise((resolve) => {
    doc.on('end', () => {
      resolve(Buffer.concat(buffers));
    });
  });
}
export async function processReceipt(donation: DonationReceipt): Promise<void> {
  try {
    const pdfBuffer = await generateDonationPDF(donation);
    console.log(`Receipt generated for donation ${donation.txnid}`);
  } catch (error) {
    console.error('Error processing receipt:', error);
    throw error;
  }
}
export async function sendWhatsAppReceipt(): Promise<boolean> {
  console.log('WhatsApp service disabled');
  return false;
}
EOF
